movingDistance=160;TeuxDeux={};$(document).ready(function(K){setInterval(function() { jQuery.get('/poller', '', function(data,textStatus){if(data === 'true'){window.location.reload();}});},300000); var curDate = new Date; setInterval(function() { var d = new Date; if (curDate.getDate() !== d.getDate()) { setTimeout(function() { window.location.reload();}, Math.floor(Math.random()*300000)); } }, 1000); K.fn.extend({id:function(){var Y=this[0].id.split("_");return Y[Y.length-1]}});var x=function(){var Y=document.createElement("LI");Y.appendChild(document.createTextNode(" "));Y.className="placeholder";return Y};var l=function(Y){return K(Y).children("li").length};var E=function(Y){return K(Y).children("li:not(.placeholder)").length};var G=function(Y){var Z=0;K(".list_items",Y).each(function(){var aa=E(this);if(aa>Z){Z=aa}});return Z};var P=function(aa,Y){var Z=G(aa);if(Z<Y){Z=Y}K(".list_items",aa).each(function(){var ac=l(this);if(ac<Z){for(var ab=0;ab<(Z-ac);ab++){K(this).append(x())}}else{if(ac>Z){for(var ab=0;ab<(ac-Z);ab++){K(this).find("li.placeholder:first").remove()}}}})};var A=17;P(K("#scrollContainer"),A);var X=10;P(K("#someday_list"),X);var o=function(){var Y=K(".someday li:not(.placeholder)").length;K(".header h2").text("someday ("+Y+")")};var N=function(aa,ab,ac){if(ac){var Z=new Date();Z.setTime(Z.getTime()+(ac*24*60*60*1000));var Y="; expires="+Z.toGMTString()}else{var Y=""}document.cookie=aa+"="+ab+Y+"; path=/"};var H=function(Z){var ab=Z+"=";var Y=document.cookie.split(";");for(var aa=0;aa<Y.length;aa++){var ac=Y[aa];while(ac.charAt(0)==" "){ac=ac.substring(1,ac.length)}if(ac.indexOf(ab)===0){return ac.substring(ab.length,ac.length)}}return null};var w=function(Y){N(Y,"",-1)};var S=0;var u=function(){return K("#user_controls li:first span").text()};var I=function(Y){Y.droppable({drop:function(Z,aa){var ab=aa.draggable.find(".teuxdeux.print_hide");var ac=ab.data("originalText")||ab.text();K(this).val(ac).focus().select();var ad=K(aa.draggable).find("a").attr("href");K(aa.draggable).remove();jQuery.post(ad,"",function(ae,af){o()})}})};var n=function(Z,Y){K(".meanwhile").stop().fadeTo("fast",1,function(){if(this.style.filter){this.style.filter=""}});K("#scrollContainer > div").fadeTo("fast",0.1);L(Z,false,function(){K("#scrollContainer > div:gt(4)").remove();K("#scrollContainer").css("left","0px");K("#scrollContainer > div").css({opacity:0.4});K("#scrollContainer > div").fadeTo("fast",1,function(){if(this.style.filter){this.style.filter=""}});S=0;var aa=k(Z);T(K("#left_nav"),aa,-1);T(K("#right_nav"),aa,5);P(K("#scrollContainer"),A);K(".meanwhile").stop().fadeTo("fast",0);setTimeout(function(){t(K(".not_done .list_items"));K(".not_done").removeClass("not_done").addClass("done")},250)},true)};K(".calendar_input").datepicker({showOn:"button",buttonImage:"/images/cal_new.png",buttonImageOnly:true,dateFormat:"yy-mm-dd",onSelect:n,beforeShow:function(Y,Z){Z.dpDiv.css({marginLeft:"1px",marginTop:"10px"})},onClose:function(Z,Y){K(".calendar_link").show();K(".ui-datepicker-trigger").hide()}});K(".ui-datepicker-trigger").attr({title:null,alt:null}).hide();K(".calendar_link").mouseenter(function(){K(this).hide();K(".ui-datepicker-trigger").show()});K(".ui-datepicker-trigger").live("mouseleave",function(){K(this).hide();K(".calendar_link").show()});I(K(".todo_item_entry:not(:disabled)"));I(K("#someday input:text"));var V=function(ab){var ac=navigator.appName;var Y=navigator.appName==="Microsoft Internet Explorer";var aa;if(Y){aa=ab.offsetHeight}else{var Z=document.defaultView.getComputedStyle(ab,"").getPropertyValue("height");var aa=Z.split("px");aa=aa[0]}return parseInt(aa,10)};function h(Z){var aa=K(Z).closest("li").attr("offsetWidth");var Y=Z.offsetWidth;if(aa===0||Y===0){return false}return aa-Y<20}var m=function(Y,Z){if(!Z){Z=Y.innerHTML.length}if(V(Y)>20||h(Y)){K(Y).closest("li").addClass("overflow");var aa=K(Y).data("originalText")||K(Y).text();K(Y).data("originalText",aa);K(Y).text(aa.substr(0,Z));m(Y,Z-5)}};var g=function(Y){K(Y).mouseenter(function(){var aa=K(this).closest("li").find("p.teuxdeux.print_hide");var ab=aa.data("originalText");K(this).closest("li").removeClass("overflow").addClass("overfloweth");aa.text(ab);var Z=this;K(Z).parent().parent().mouseleave(function(){K(this).closest("li").removeClass("overfloweth").addClass("overflow");m(aa.get(0));K(".overflow_abs").unbind("mouseleave")})})};g(K(".ellipsis"));var R=function(Y,Z){K(".task").die("click",B)};var d=function(Y,Z){Z.item.css({top:"0",left:"0"});setTimeout(function(){K(".task").live("click",B);v();P(K("#someday_list"),X);P(K("#scrollContainer"),A);Z.item.find(".teuxdeux.print_hide").mouseleave()},100)};var z=function(Z,aa){var ac=K(aa.item).id();var ab=K(this).id();var Y=null;while(Y=K(aa.item).prev(".placeholder").get(0)){K(Y).remove()}jQuery.post("/user/update_order/"+ab,K(this).sortable("serialize"),function(ad){o()});K(this).find(".overflow_abs").mouseleave()};var Q=function(Y,Z){if(K(this).children().size()===1){var aa=K(this).id();jQuery.post("/user/update_order/"+aa,"",function(ab){o()})}};var e=function(Y,Z){P(K("#scrollContainer"),A);P(K("#someday_list"),X);if(Z.sender.get(0)!==this){Z.sender.append(x())}};var O=function(Y,Z){};var t=function(Y){return K(Y).sortable({connectWith:".list_items",cursor:"hand",delay:50,tolerance:"pointer",placeholder:"",cancel:"a,li.placeholder",start:R,stop:d,update:z,remove:Q,over:e,out:O})};var B=function(){var Y=K(this).closest("li");var Z=Y.id();jQuery.post("/user/toggle_todo/"+Z,"",function(){});if(Y.hasClass("done")){Y.removeClass("done");Y.find("a").hide();_gaq.push(["_trackEvent","Todo List","Mark Item Not Finished",u()])}else{Y.addClass("done");Y.find("a").show();_gaq.push(["_trackEvent","Todo List","Mark Item Finished",u()])}return false};K(".task").live("click",B);K(".delete").live("click",function(){var Y=K(this).closest(".day_wrapper").parent().parent();K(this).closest("li.done").remove();v();jQuery.post(this.href,"",function(Z,aa){o();P(Y,A)});_gaq.push(["_trackEvent","Todo List","Delete Item",u()]);return false});var D=function(Z,aa){var Y=K("#todo_item_placeholder").clone().attr({id:"item_to_replace"});Y.find(".teuxdeux.print_hide").text(Z.value);if(aa.find(".placeholder:first").length===1){aa.find(".placeholder:first").before(Y.show())}else{aa.append(Y.show())}P(K("#scrollContainer"),A);P(K("#someday_list"),X);m(Y.find(".teuxdeux.print_hide").get(0));jQuery.post(Z.form.action,K(Z.form).serialize(),function(ab){K("#item_to_replace").replaceWith(ab);m(aa.find("li:not(.placeholder):last").find(".teuxdeux.print_hide").get(0));g(aa.find("li:not(.placeholder):last").find(".ellipsis"));v();_gaq.push(["_trackEvent","Todo List","Create Todo Item",u()]);o()})};var q=function(Y){if(Y.keyCode===13){if(K(this).val()!==""){D(this,K(this).parent().siblings("ul"));K(this).val("")}return false}};K(".todo_item_entry").live("keypress",q);K(".list_items li.done").live("mouseenter",function(){K(this).find("a").show()});K(".list_items li.done").live("mouseleave",function(){K(this).find("a").hide()});t(K(".list_items"));K("#scrollContainer > div:eq(4)").addClass("last");K(".red input:text").focus();K("input:text").attr("autocomplete","off");var k=function(Z){Z=Z.split("-");var aa=parseInt(Z[0],10);var ab=parseInt(Z[1],10);var Y=parseInt(Z[2],10);return new Date(aa,ab-1,Y)};var W=function(Y){return k(Y.href.split("?")[1].split("=")[1])};var C=function(Y,Z){var aa=new Date(Y);aa.setDate(aa.getDate()+Z);return aa};var T=function(ac,aa,Z){var ad=ac.find(".single");var Y=ad.attr("href").split("?");ad.attr("href",Y[0]+"?date="+M(C(aa,Z)));Z=Z<1?Z*5:Z;var ab=ac.find(".week");var Y=ab.attr("href").split("?");ab.attr("href",Y[0]+"?date="+M(C(aa,Z)))};var f=function(aa,Z,Y){var ab=M(aa);jQuery.get("/user/load_day",{date:ab},function(ac,ae){if(Z){K("#scrollContainer").append(ac)}else{K("#scrollContainer").prepend(ac)}P(K("#scrollContainer"),A);K(".not_done").each(function(){$this=K(this);I($this.find(".todo_item_entry:not(:disabled)"));$this.find(".teuxdeux.print_hide").each(function(){var af=this;setTimeout(function(){m(af)},5)});g($this.find(".ellipsis"))});U();var ad=K("#scrollContainer").children().size();K("#scrollContainer").css("width",((ad+2)*movingDistance)+"px");Y()})};var L=function(aa,Z,Y,ac){var ab=typeof(aa)=="string"?aa:M(aa);jQuery.get("/api/list.html",{date:ab,munge:false,site:true},function(ad,af){if(Z){K("#scrollContainer").append(ad)}else{K("#scrollContainer").prepend(ad)}P(K("#scrollContainer"),A);K(".not_done").each(function(){$this=K(this);I($this.find(".todo_item_entry:not(:disabled)"));$this.find(".teuxdeux.print_hide").each(function(){var ag=this;setTimeout(function(){m(ag)},5)});g($this.find(".ellipsis"))});U();var ae=K("#scrollContainer").children().size();K("#scrollContainer").css("width",((ae+2)*movingDistance)+"px");Y()})};var s=function(){return false};var p=function(){K(".left, .right, .week").unbind("click").click(s)};var j=function(){K(".left.single, .right.single, .week").unbind("click");K(".left.single").click(y(1,function(){return S!==0},f));K("#left_nav .rel .week").click(y(5,function(){return S>4},L));K(".right.single").click(a(1,function(){return S+5<K("#scrollContainer").children().size()},f));K("#right_nav .rel .week").click(a(5,function(){return S+10<K("#scrollContainer").children().size()},L))};var y=function(aa,Z,Y){return function(ad){p();if(Z()){b(false,aa);K(".someday:eq(4)").addClass("last")}else{var ac=W(this);var ab=this;Y(ac,false,function(){S+=aa;var ae=parseInt(K("#scrollContainer").css("left"),10);K("#scrollContainer").css("left",ae-movingDistance*aa);T(K("#left_nav"),ac,-1);b(false,aa);K(".someday:eq(4)").addClass("last")})}return false}};var a=function(aa,Z,Y){return function(ad){p();if(Z()){b(true,aa);K(".someday:eq(4)").addClass("last")}else{var ac=W(this);var ab=this;Y(ac,true,function(){T(K("#right_nav"),ac,aa);b(true,aa);K(".someday:eq(4)").addClass("last")})}return false}};j();K("#scrollContainer").css("width",movingDistance*7).data("currentlyMoving",false);var b=function(ad,Z){if(K("#scrollContainer").data("currentlyMoving")==false){K("#scrollContainer").data("currentlyMoving",true);var aa=ad?S+Z:S-Z;var ae=K("#scrollContainer").css("left");var Y=ad?parseFloat(ae,10)-movingDistance*Z:parseFloat(ae,10)+movingDistance*Z;S=aa;K("#scrollContainer .last").removeClass("last");var ac=S+4;var ab="#scrollContainer > div:eq("+ac+")";K(ab).addClass("last");K("#scrollContainer").stop().animate({left:Y},function(){K("#scrollContainer").data("currentlyMoving",false);j();K("#scrollContainer .list_items").sortable("destroy");var ag="";for(var af=0;af<5;af++){ag+=".list_items:eq("+(af+S)+")";if(af!=4){ag+=", "}}setTimeout(function(){t(K(ag));K(".not_done").removeClass("not_done").addClass("done")},5)})}};var M=function(Y){return Y.getFullYear()+"-"+(Y.getMonth()+1)+"-"+(Y.getDate())};var v=function(){var Z=0;var aa=400;var Y=25;K("#scrollContainer .list_items").each(function(){var ac=K(this);var ab=ac.children().size();if(ab>Z){Z=ab}});if(Z>(aa/Y)){aa=Z*Y}K("#scrollContainer .list_items").css({"min-height":aa+"px"})};v();var r=function(Y){N("someday_state","0",3650);K(".triangle").removeClass("open");K("#someday_list").hide("blind",{},Y,function(){_gaq.push(["_trackEvent","Todo List","Hide Someday List",u()]);K(".header a").unbind("click").click(function(){c();return false})});return false};var c=function(){N("someday_state","1",3650);K(".triangle").addClass("open");K("#someday_list").show("blind",{},750,function(){_gaq.push(["_trackEvent","Todo List","Show Someday List",u()]);K(".header a").unbind("click").click(function(){r(750);return false})});return false};K(".header input:text").keypress(function(Y){if(Y.keyCode===13){if(K(this).val()!=""){D(this,K(".someday:first"));K(this).val("")}return false}});o();K(".header a").click(r);K(".save").click(function(){var Y=K(this).parents("form");Y.submit();return false});var i=function(){if(K("#scrollContainer").data("currentlyMoving")==false){K("#scrollContainer").data("currentlyMoving",true);var Y=K("#scrollContainer > div").length;if(Y==5){K("#scrollContainer").data("currentlyMoving",false);j();return}var Z=K("#scrollContainer > div").index(K("#today"));var aa=Z+5>Y?Y-5:Z;var ad=-movingDistance*aa;S=aa;K("#scrollContainer .last").removeClass("last");var ac=S+4;var ab="#scrollContainer > div:eq("+ac+")";K(ab).addClass("last");K("#scrollContainer").stop().animate({left:ad},function(){K("#scrollContainer").data("currentlyMoving",false);j();K(".list_items").sortable("destroy");var af="";for(var ae=0;ae<5;ae++){af+=".list_items:eq("+(ae+S)+")";if(ae!=4){af+=", "}}setTimeout(function(){t(K(af));K(".not_done").removeClass("not_done").addClass("done")},5)})}};K("#right_nav, #left_nav").live("mouseenter",function(){K(this).find(".advanced").removeClass("closed")}).live("mouseleave",function(){K(this).find(".advanced").addClass("closed")});K("#scrollContainer > div").removeClass("not_done").addClass("done");K("#goto_today").click(function(){if(K(".red").length===0){n(M(new Date()))}else{p();i()}return false});K("#editbubble .x").click(function(){K("#editbubble").remove();K.post("/user/clear_bubble",{bubble:1});return false});K("#newgubbinsbubble .x").click(function(){K("#newgubbinsbubble").remove();K.post("/user/clear_bubble",{bubble:2});return false});TeuxDeux.leftOne=function(){K(".left.single").click()};TeuxDeux.leftFive=function(){K("#left_nav .rel .week").click()};TeuxDeux.rightOne=function(){K(".right.single").click()};TeuxDeux.rightFive=function(){K("#right_nav .rel .week").click()};var J=function(){if(H("someday_state")===null){N("someday_state","1",3650)}else{if(H("someday_state")==="0"){r(0)}}};J();K(".arrow").mouseenter(function(){K(this).find(".rel").removeClass("closed")}).mouseleave(function(){K(this).find(".rel").addClass("closed")});var U=function(){if(K("#fluid").val()=="true"){K("#container").removeClass("fixed").addClass("fluid");var Y=K("#deux_list").width();K("#scrollContainer > div").width(Y/5);K("#scrollContainer").width("10000px");movingDistance=Y/5;K("#scrollContainer").css("left",-S*movingDistance+"px")}};var F=function(){K(".teuxdeux.print_hide").each(function(){var Y=K(this).data("originalText");K(this).text(Y);m(this)})};U();K(window).resize(function(){U();if(K("#fluid").val()=="true"){K(".overflow").removeClass("overflow");F()}});K(".teuxdeux.print_hide").each(function(){m(this)})});